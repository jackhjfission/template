# Cookiecutter Template Generation

This repository serves as both a working Python monorepo template AND can be converted into a cookiecutter template.

## Overview

The `generate_cookiecutter.py` script automatically transforms this working repository into a cookiecutter-ready template by:

1. Copying all relevant files to `cookiecutter-output/`
2. Renaming directories with cookiecutter template syntax (e.g., `template_core` → `{{cookiecutter.project_slug}}_core`)
3. Replacing hardcoded values with cookiecutter variables
4. Creating a `cookiecutter.json` configuration file

## Workflow

### Development Mode
Work on the template normally:
```bash
# Make changes to the template
git add .
git commit -m "Add new feature"
git push

# Test features in the working template as usual
cd template_core
poetry install
poetry run pytest
```

### Generate Cookiecutter Template
When you're ready to create/update the cookiecutter template:

```bash
# Generate the cookiecutter template
python generate_cookiecutter.py

# Output will be in cookiecutter-output/ (gitignored)
```

### Test the Cookiecutter Template
```bash
# Install cookiecutter if you haven't already
pip install cookiecutter

# Test the generated template locally
cookiecutter cookiecutter-output/

# You'll be prompted for values like:
# - project_slug: myproject
# - project_name: My Project
# - author_name: Your Name
# - author_email: you@example.com
# - docker_image_name: myproject
# - docker_service_name: myproject-dev
# - user_name: devuser
# - docker_image_version: v0.0.0
```

## Cookiecutter Variables

The following variables are configurable in `cookiecutter-output/cookiecutter.json`:

| Variable | Default | Description |
|----------|---------|-------------|
| `project_slug` | `myproject` | Base name for packages (generates `{slug}_core` and `{slug}_tools`) |
| `project_name` | `My Project` | Human-readable project name |
| `author_name` | `Your Name` | Author's full name |
| `author_email` | `you@example.com` | Author's email address |
| `docker_image_name` | `myproject` | Name for Docker image |
| `docker_service_name` | `myproject-dev` | Name for docker-compose service |
| `user_name` | `devuser` | Username in DevContainer |
| `docker_image_version` | `v0.0.0` | Docker image version tag |

## What Gets Templated

The script automatically replaces:

### Package Names
- `template_core` → `{{cookiecutter.project_slug}}_core`
- `template_tools` → `{{cookiecutter.project_slug}}_tools`

### CLI Scripts
- `template-core` → `{{cookiecutter.project_slug}}-core`
- `template-tools` → `{{cookiecutter.project_slug}}-tools`

### DevContainer Configuration
- Container name, image names, user paths
- Docker service names
- Environment variables

### Documentation
- README.md project title and references
- Package descriptions in pyproject.toml
- Git clone URLs

### Cross-Package Dependencies
- Path references in pyproject.toml
- Python imports in source files

## Files Excluded from Cookiecutter

The following are NOT copied to the cookiecutter template:

- `.git/` - Git history
- `__pycache__/`, `.pytest_cache/`, `.mypy_cache/` - Python cache
- `poetry.lock` - Lock files (regenerated by users)
- `.venv/`, `venv/` - Virtual environments
- `cookiecutter-output/` - The output directory itself
- `generate_cookiecutter.py` - The generation script

## Future Enhancement: Automated Deployment

To automate pushing the cookiecutter template to a separate repository:

### 1. Create a separate GitHub repository for the cookiecutter template
```bash
# On GitHub, create a new repository (e.g., "my-project-cookiecutter")
```

### 2. Add GitHub Actions workflow (`.github/workflows/update-cookiecutter.yml`)
```yaml
name: Update Cookiecutter Template

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  update-cookiecutter:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source repo
        uses: actions/checkout@v3
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      
      - name: Generate cookiecutter template
        run: python generate_cookiecutter.py
      
      - name: Push to cookiecutter repo
        env:
          COOKIECUTTER_REPO_TOKEN: ${{ secrets.COOKIECUTTER_REPO_TOKEN }}
        run: |
          cd cookiecutter-output
          git init
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add .
          git commit -m "Update cookiecutter template from ${{ github.sha }}"
          git remote add origin https://x-access-token:${COOKIECUTTER_REPO_TOKEN}@github.com/USERNAME/COOKIECUTTER-REPO.git
          git push -f origin main
```

### 3. Configure GitHub secrets
Add `COOKIECUTTER_REPO_TOKEN` to your repository secrets with a personal access token that has write access to the cookiecutter repository.

### 4. Users can then create new projects with:
```bash
cookiecutter gh:USERNAME/COOKIECUTTER-REPO
```

## Customizing the Generation

Edit `generate_cookiecutter.py` to:

- Add new cookiecutter variables to `COOKIECUTTER_CONFIG`
- Add new replacement patterns in `process_text_content()`
- Exclude additional files/directories in `EXCLUDE_PATTERNS`
- Handle new file types or special cases

## Troubleshooting

### Issue: Some files not being templated correctly
- Check if the file type is handled in `process_text_content()`
- Add specific regex patterns for the content that needs replacement

### Issue: Files being excluded that shouldn't be
- Review `EXCLUDE_PATTERNS` in the script
- Make sure the file/directory isn't matching any exclusion patterns

### Issue: Cookiecutter template not working
- Verify the template syntax with: `cookiecutter --verbose cookiecutter-output/`
- Check that all `{{cookiecutter.*}}` variables are properly closed
- Ensure directory names use valid cookiecutter syntax

## Benefits of This Approach

✅ **Single Source of Truth**: One working template, not two codebases to maintain  
✅ **Always Testable**: You can test new features in the working template before generating  
✅ **No Branch Conflicts**: No need to maintain separate branches for template vs cookiecutter  
✅ **Easy Updates**: Run one script to regenerate the cookiecutter whenever you update features  
✅ **Flexible**: Can generate locally or via CI/CD, keep locally or publish to separate repo  

## Next Steps

1. Keep developing your template as normal
2. When ready to distribute, run `python generate_cookiecutter.py`
3. Test with `cookiecutter cookiecutter-output/`
4. Optionally set up automated deployment to a separate repository
5. Share your cookiecutter template with others!
